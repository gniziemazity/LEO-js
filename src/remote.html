<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>LEO Remote</title>
		<link rel="icon" href="icon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="styles.css" />
	</head>
	<body class="mobile-view">
		<div id="mobile-header">
			<div class="header-main-row">
				<button
					id="toggleBtn"
					class="interaction-btn btn-start"
					onclick="toggleActive()"
				>
					‚ñ∂Ô∏é
				</button>
				<div id="interactionButtons">
					<button
						class="interaction-btn btn-student-question"
						onclick="handleInteractionBtn('student-question')"
						title="Student Question"
					>
						<span class="dark-emoji">‚ùì</span>
					</button>
					<button
						class="interaction-btn btn-help"
						onclick="handleInteractionBtn('providing-help')"
						title="Providing Help"
					>
						<span class="dark-emoji">ü§ù</span>
					</button>
					<button
						id="touchpadBtn"
						class="interaction-btn btn-touchpad"
						onclick="toggleTouchpad()"
						title="Toggle Touchpad"
					>
						<span class="dark-emoji">üñ±Ô∏è</span>
					</button>
				</div>
				<div id="timerSection">
					<button
						id="timerStartBtn"
						class="timer-btn"
						onclick="startTimer()"
						title="Start Timer"
					>
						‚è±Ô∏è
					</button>
					<div id="timerControls" class="timer-controls">
						<button
							class="timer-btn"
							onclick="adjustTimer(-10)"
							title="-10 min"
						>
							‚Äì
						</button>
						<span
							id="timerDisplay"
							class="timer-display"
							onclick="stopTimer()"
							title="Click to stop"
						></span>
						<button
							class="timer-btn"
							onclick="adjustTimer(10)"
							title="+10 min"
						>
							+
						</button>
					</div>
				</div>
			</div>
			<div class="progress-bar" id="progressBar"></div>
		</div>

		<div id="lesson-container">
			<div class="empty-state">Connecting to LEO...</div>
		</div>

		<div id="touchpadOverlay" class="touchpad-overlay">
			<div class="touchpad-toolbar">
				<button
					id="modeBtn"
					class="touchpad-tb-btn"
					onclick="toggleTouchpadMode()"
				>
					<span class="tb-emoji">üñ±Ô∏è</span> Mouse
				</button>
				<button
					class="touchpad-tb-btn touchpad-close-btn"
					onclick="toggleTouchpad()"
				>
					‚úï
				</button>
			</div>
		</div>

		<div id="questionOverlay" class="overlay">
			<div class="q-modal">
				<div class="q-question-text" id="qText"></div>
				<div class="q-subtitle" id="qSubtitle">Who answered?</div>
				<div class="q-grid" id="qGrid"></div>
				<div class="q-answered-row" id="qAnsweredRow">
					<span id="qAnsweredText"></span>
					<div class="q-close-bar">
						<div class="q-close-bar-fill" id="qCloseBarFill"></div>
					</div>
				</div>
			</div>
		</div>

		<div id="interactionOverlay" class="overlay">
			<div class="i-modal" id="iModal">
				<div class="i-title" id="iTitle">Select student</div>
				<input
					type="text"
					class="i-question-input"
					id="iQuestionInput"
					placeholder="Type the question here..."
					style="display: none"
				/>
				<div class="i-grid" id="iGrid"></div>
				<button class="i-cancel-btn" onclick="closeInteractionOverlay()">
					Cancel
				</button>
			</div>
		</div>

		<script src="remote/connection.js"></script>
		<script src="remote/touchpad.js"></script>
		<script src="remote/timer.js"></script>
		<script src="remote/lesson.js"></script>
		<script src="remote/overlays.js"></script>

		<script>
			function handleMessage(message) {
				const { type, data } = message;
				switch (type) {
					case "state":
						updateAllState(data);
						break;
					case "lesson-data":
						updateLessonData(data);
						break;
					case "cursor":
						updateCursor(data);
						break;
					case "progress":
						updateProgress(data);
						break;
					case "settings":
						applySettings(data);
						break;
					case "active":
						updateActiveState(data.isActive);
						break;
					case "students":
						setStudents(data.students);
						break;
					case "question-started":
						showQuestionOverlay(
							data.question,
							data.students,
							data.bgColor,
						);
						break;
					case "question-ended":
						hideQuestionOverlay();
						break;
					case "timer-tick":
						showTimerRunning(data.timeRemaining);
						break;
					case "timer-stopped":
						showTimerStopped();
						break;
				}
			}

			function updateAllState(state) {
				updateProgress(state);
				if (state.isActive !== undefined) updateActiveState(state.isActive);
				if (state.settings) applySettings(state.settings);
				if (state.lessonData) updateLessonData(state.lessonData);
				if (state.currentStep !== undefined)
					updateCursor({ currentStep: state.currentStep });
				if (state.students) setStudents(state.students);
				if (state.activeQuestion)
					showQuestionOverlay(
						state.activeQuestion,
						state.students || [],
						null,
					);
				if (state.timeRemaining != null)
					showTimerRunning(state.timeRemaining);
				else showTimerStopped();
			}

			setMessageHandler(handleMessage);
			initTouchpad();
			setTimeout(connect, 500);
		</script>
	</body>
</html>
